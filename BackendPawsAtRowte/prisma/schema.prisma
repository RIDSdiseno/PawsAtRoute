generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://postgres:DEkoSEMyeiqaOXEViwkmrrKQDFeHyLYC@interchange.proxy.rlwy.net:26066/railway"
}

model Usuario {
  idUsuario          Int            @id @default(autoincrement())
  rut                String
  nombre             String
  apellido           String
  telefono           String
  fNacimiento        DateTime?
  correo             String         @unique
  carnetIdentidad    String?
  antecedentes       String?
  rol                Rol
  passwordHash       String
  comuna             String
  mascotas           Mascota[]
  paseosComoDuenio   Paseo[]        @relation("DuenioPaseo")
  paseosComoPaseador Paseo[]        @relation("PaseadorPaseo")
  refreshTokens      RefreshToken[]
  tarjetas           Tarjeta[]
}

model Mascota {
  idMascota Int     @id @default(autoincrement())
  usuarioId Int
  nombre    String
  especie   String
  raza      String
  edad      Int
  usuario   Usuario @relation(fields: [usuarioId], references: [idUsuario])
  paseos    Paseo[]
}

model Paseo {
  idPaseo        Int         @id @default(autoincrement())
  mascotaId      Int
  duenioId       Int
  paseadorId     Int?        // OPCIONAL
  fecha          DateTime
  hora           DateTime
  duracion       Int
  lugarEncuentro String
  estado         EstadoPaseo @default(PENDIENTE)
  notas          String?

  mascota  Mascota  @relation(fields: [mascotaId], references: [idMascota])
  duenio   Usuario  @relation("DuenioPaseo", fields: [duenioId], references: [idUsuario])
  paseador Usuario? @relation("PaseadorPaseo", fields: [paseadorId], references: [idUsuario])
}

model Tarjeta {
  idTarjeta     Int     @id @default(autoincrement())
  userId        Int
  numero        String
  nombreTitular String
  vencimiento   String
  cvv           String
  tipo          String
  usuario       Usuario @relation(fields: [userId], references: [idUsuario])
}

model RefreshToken {
  id                Int       @id @default(autoincrement())
  userId            Int
  rtHash            String
  createdAt         DateTime  @default(now())
  expiresAt         DateTime
  revokedAt         DateTime?
  replacedByTokenId Int?
  userAgent         String?
  ip                String?
  user              Usuario   @relation(fields: [userId], references: [idUsuario])

  @@index([rtHash])
  @@index([userId])
}

enum Rol {
  PASEADOR
  DUEÑO       @map("DUEÑO") 
  @@map("Rol")  
}

enum EstadoPaseo {
  PENDIENTE
  ACEPTADO
  EN_CURSO
  FINALIZADO
  CANCELADO
}
